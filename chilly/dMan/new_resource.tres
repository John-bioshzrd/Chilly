[gd_resource type="Resource" load_steps=2 format=3 uid="uid://dnub14xkj7r1x"]

[sub_resource type="GDScript" id="GDScript_8v0ch"]
script/source = "class_name VNCharacter
extends TextureRect

@export var data:VNCharacterData

signal garbage_error


func _ready() -> void:
	texture = data.default_sprite


func attr(attribute:String = \"\") -> void:
	print(\"Getting attribute \" + attribute)

	if !data.tagged_sprites.has(attribute):
		push_warning(\"Missing sprite tag: \" + attribute)
		texture = data.default_sprite
		return

	texture = data.tagged_sprites[attribute]


func snap(targ:Node) -> void:
	global_position = targ.global_position + Vector2(-size.x / 2, 0)


func move(
	targ:Node,
	seconds:float = 1.0,
	trans:Tween.TransitionType = Tween.TRANS_QUAD
) -> Signal:
	var pos:Vector2 = targ.global_position + Vector2(-size.x / 2, 0)

	var tween:Tween = get_tree().create_tween()
	tween.tween_property(self, \"global_position\", pos, seconds).set_trans(trans)

	return tween.finished


func say(text:String, tag:String = \"\") -> Signal:
	var d := data.dialog_box.instantiate()

	if d == null:
		push_error(\"DialogBox PackedScene failed to instantiate\")
		emit_signal(\"garbage_error\")
		return garbage_error

	d.dialog = text
	get_tree().root.add_child(d)

	return d.complete
"

[resource]
script = SubResource("GDScript_8v0ch")
